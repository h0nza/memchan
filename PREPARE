# -*- tcl -*-
# prepare module MEMCHAN for distribution
# CVS:	$Id: PREPARE,v 1.30 2002/04/25 06:29:48 andreas_kupries Exp $

# Exclude older binary distributions, they are made available through the 1.9 site.

mExclude \
	doc/nodes doc/manual



# O. insert various information into some files
#    (version, patchlevel, current date)

mExclude LSM ANNOUNCE

eval mInsertInfo \
	DESCRIPTION \
	README win/README win/README.VC mac/README \
	unix/configure.in unix/Makefile.in \
	tea/configure.in tea/Makefile.in tea/pkgIndex.tcl \
	[glob win/makefile.vc*] win/Makefile.gnu win/mc.rc

mGetDescription
mExpandUrls
mGenerateLSM
mGenerateANNOUNCE

package require MSA
mGenerateAnnounceMail tcl-announce@mitchell.org lvirden@cas.org
mSupport    AMAIL
file delete AMAIL

#file copy unix/pkgIndex.tcl.in win/pkgIndex.tcl

set mInfo(@configure_input@)  "Distributed at $mDate"
set mInfo(@MEMCHAN_VERSION@)  $mVersion
#set mInfo(@MC_USING_STUBS@)   1 ; # implicit usage on Win*
set mInfo(@MEMCHAN_LIB_FILE@) memchan${mShortDosVersion} ; # .dll added by index file itself
#                             ~~~~~ coordinate with win/makefile.*
mInsertInfo win/pkgIndex.tcl

# remove internal directories

mExclude patches mails

# generate configure script to be used
mConfigure unix
mConfigure tea

# Integrate tk-based testsuite interface.

if {0} {
    exec makedist tg
    exec tar xfz [glob tg*.tar.gz]
    eval file delete \
	    [glob tg*.README] [glob tg*.ANNOUNCE] \
	    [glob tg*.LSM] [glob tg*.tar.gz] \
	    [glob tg*.DESCRIPTION]
    
    eval file rename [glob tg*] testlib
}

# Now generate documentation for linkage into my
# site and standalone distribution

cd doc
exec ../tools/manpage_regen > /dev/null 2>/dev/null
cd ..

file mkdir doc/art

file rename htdocs/art/logo100.gif doc/art/
file rename htdocs/art/logo520.jpg doc/art/
file rename htdocs/art/logo64.gif  doc/art/

mExclude htdocs


#mHandleBinaryDistributions
#mHandleBinaryDistributions doc/license.terms README

# create the file required by the NeoSoft CSA
file copy ChangeLog.short CHANGES

# Move the files in TEA into the main directory.

file rename         tea/README README.tea
eval file rename -- [glob tea/*] [pwd]
file delete -force tea
